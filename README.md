<h1 align="center">
  Desafio Database Queries
</h1>

<br>

## üíª Sobre o desafio

Nesse desafio, voc√™ realizar√° consultas no banco de dados com o TypeORM de tr√™s maneiras:

- Usando o ORM
- Usando Query Builder
- Usando Raw Query

Isso ir√° te ajudar a entender e exercitar os diferentes tipos de consultas que podemos fazer.

No template, voc√™ ir√° encontrar uma aplica√ß√£o j√° estruturada (apenas as entidades e reposit√≥rios) onde voc√™ dever√° completar o que falta nas consultas dos dois reposit√≥rios.

A aplica√ß√£o possui dois m√≥dulos: `users` e `games`. Um **usu√°rio** pode ter v√°rios jogos e um mesmo **jogo** pode estar associado a v√°rios usu√°rios.

## Preparando o ambiente para os testes

Para que os testes funcionem, √© importante que voc√™ crie uma database no banco Postgres com o nome queries_challenge e substitua os dados de autentica√ß√£o (caso os seus n√£o sejam os mesmos) no arquivo ormconfig.json

Se voc√™ n√£o possui um container do Docker rodando o Postgres, √© poss√≠vel cri√°-lo com seguinte comando:

```bash
docker run --name ignite-challenge-database-queries -e POSTGRES_DB=queries_challenge -e POSTGRES_PASSWORD=docker -p 5432:5432 -d postgres
```

Com isso, o container com o banco Postgres ser√° instalado e ficar√° rodando pronto para voc√™ come√ßar implementar o desafio.

Quando o desafio estiver finalizado, voc√™ pode parar o container com o comando `docker stop ignite-challenge-database-queries` para que n√£o fique consumindo recursos desnecess√°rios da sua m√°quina. E caso voc√™ tenha parado o container ou reiniciou sua m√°quina mas ainda precisa do container rodando, √© poss√≠vel inici√°-lo novamente com o comando `docker start ignite-challenge-database-queries`.

## Espec√≠fica√ß√£o dos testes

Para esse desafio, temos os seguintes testes:

- **[UsersRepository] should be able to find user with games list by user's ID**
    
    - M√©todo **findUserWithGamesById**
    
    Esse m√©todo deve receber o **Id** de um usu√°rio e retornar os dados do usu√°rio encontrado juntamente com os dados de todos os **games** que esse usu√°rio possui.
    
    
- **[UsersRepository] should be able to list users ordered by first name**
    
    Esse m√©todo deve retornar a listagem de usu√°rios cadastrados em ordem alfab√©tica (**ASC**).

    Lembre-se que aqui deve ser usado **raw query** para a consulta.
    
- **[UsersRepository] should be able to find user by full name**
    
    Esse m√©todo deve receber `first_name` e `last_name` e retornar um usu√°rio que possua os mesmos `first_name` e `last_name`. Aqui voc√™ deve encontrar o usu√°rio ignorando se o argumento passado est√° em caixa alta ou n√£o. 

    Por exemplo, suponhamos que existe um usu√°rio onde o `first_name` √© `Danilo` e o `last_name` √© `Vieira`. O m√©todo deve retornar o usu√°rio mesmo que os argumentos passados sejam `daNiLo` para `first_name` e `vIeiRA` para `last_name`. Essa consulta deve ser realizada utilizando **raw query** e voc√™ pode buscar pelo uso do **LOWER** no Postgres para resolver esse problema.
    
- **[GamesRepository] should be able find a game by entire or partial given title**
    
    Esse m√©todo deve receber parte do t√≠tulo de um jogo ou o t√≠tulo inteiro e retornar um ou mais jogos que derem match com a consulta. 

    Se o m√©todo for chamado com o argumento `"or S"` e existir algum jogo com essa sequ√™ncia de letras no t√≠tulo, o retorno deve ser feito, como por exemplo o seguinte retorno:

    ```jsx
    [
      {
        id: '63a6c35a-ac97-4773-9021-fb93973c8139',
        title: 'Need For Speed: Payback',
        created_at: '2021-03-19 19:35:09.877037',
        updated_at: '2021-03-19 19:35:09.877037',
      },
      {
        id: '74e4fc3b-434d-4452-94eb-27a85dce8d1a',
        title: 'Need For Speed: Underground',
        created_at: '2021-03-19 19:35:09.877037',
        updated_at: '2021-03-19 19:35:09.877037',
      }
    ]
    ```

    A consulta tamb√©m deve ser feita de forma case insensitive, ignorando caixa alta onde no banco n√£o existe. Para exemplo, considerando a busca exemplificada acima, o retorno deve ser o mesmo caso o par√¢metro passado seja uma string `"nEEd"`. 

    Voc√™ pode buscar pelo uso do **ILIKE** no Postgres para resolver esse problema. Lembre-se que aqui deve ser usado **query builder** para realizar a consulta.
    
- **[GamesRepository] should be able to get the total count of games**
    
    Esse m√©todo deve retornar uma contagem do total de games existentes no banco. Deve ser usada raw query para essa consulta.
    
- **[GamesRepository] should be able to list users who have given game id**
    
    Esse m√©todo deve receber o `Id` de um game e retornar uma lista de todos os usu√°rios que possuem o game do `Id` informado. 

    Exemplo de retorno:

    ```jsx
    [
      {
        id: '81482ac4-29bd-497f-b71a-8ae3b20eca9b',
        first_name: 'John',
        last_name: 'Doe',
        email: 'mail@example.com',
        created_at: '2021-03-19 19:35:09.877037',
        updated_at: '2021-03-19 19:35:09.877037'
      },
      {
        id: '75920ac4-32ed-497f-b71a-8ae3c19eca9b',
        first_name: 'Usu√°rio',
        last_name: 'Qualquer',
        email: 'usuarioqualquer@example.com',
        created_at: '2021-03-19 19:35:09.877037',
        updated_at: '2021-03-19 19:35:09.877037'
      }
    ]
    ```

## üòÅ Como utilizar

Antes de mais nada, para que os comandos a seguir funcione, √© necessario ter o <a href="https://nodejs.org/en/" target="_blank" >node.js</a> instalado em sua m√°quina.

Ap√≥s carregar o projeto em sua m√°quina √© necess√°rio fazer os seguintes comandos:

* Instalar as depend√™ncias: `npm install` | `yarn`
* Para realizar os testes use o comando: `npm run test` | `yarn test`
* Para rodar o projeto digite o comando: `npm run dev` | `yarn dev`

Abra o navegador e acesse: http://localhost:3333
